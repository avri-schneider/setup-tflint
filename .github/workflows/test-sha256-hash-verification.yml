name: Lint
on:
  push:
    branches: [ test-sha256-hash-verification ]
  pull_request:

jobs:
  tflint:
    runs-on: ${{ matrix.os }}

    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest],
        expected_sha256: [
          "bf758ff29b607b3fbc4a3630ea3b39df4afafe3cdb80c6d71fe528feeac2c58e",  # Ubuntu
          "d47f0aeabc1234567890fedcba0987654321fedcba09876543210ae123456789",  # macOS
          "5a3b9a1cdef123456789fedcba0987654321fedcba0987654321abcd123456ef"   # Windows
        ]
    steps:
    - uses: actions/checkout@v4
      name: Checkout source code

    - uses: actions/cache@v4
      name: Cache plugin dir
      with:
        path: ~/.tflint.d/plugins
        key: ${{ matrix.os }}-tflint-${{ hashFiles('.tflint.hcl') }}

    - uses: avri-schneider/setup-tflint@test-sha256-hash-verification
      name: Setup TFLint
      with:
        expected_sha256: "bf758ff29b607b3fbc4a3630ea3b39df4afafe3cdb80c6d71fe528feeac2c58e"
        tflint_version: v0.52.0

    - name: Show version
      run: tflint --version
